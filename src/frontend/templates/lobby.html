{% extends "base.html" %}
{% block content %}
<div class="lobby-container">
  <h2>Chat Lobby</h2>
  <p>Welcome, <span class="username">{{ username }}</span>!</p>

  <h3>Connected Users:</h3>
  <div class="user-list-container">
    <ul id="userList" class="user-list"></ul>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<script>
  const username = "{{ username }}";
  const socket = io("ws://localhost:5002", {
    query: {
      username: username
    }
  });

  const userList = document.getElementById("userList");

  socket.on("connect", () => {
    console.log("Connected to the lobby");
  });

  socket.on("update_user_list", (users) => {
    userList.innerHTML = "";
    users.forEach((user) => {
      const li = document.createElement("li");
      li.classList.add("user-item");
      li.innerText = user;
      userList.appendChild(li);
    });
  });

  socket.on("disconnect", () => {
    console.log("Disconnected from the server");
  });
</script>
{% endblock %}
